const option={load:25,gap:15,nextPage:2,maxWidth:300,query:"",container:"wallpaperContainer",api:""},imgObserver=(e=1)=>{let t=(e,t)=>{e.forEach(e=>{if(e.isIntersecting){let a=e.target;a.setAttribute("src",a.getAttribute("data-src")),a.classList.remove("animate-pulse"),a.classList.remove("wallpaperCardLazyLoad"),t.unobserve(e.target)}})},a=new IntersectionObserver(t);$all("img.wallpaperCardLazyLoad").forEach(t=>{2==e&&console.log(t),a.observe(t)})};class WallpaperLayout{constructor(e=option.container){this.container=$id(e),this.gap=option.gap,this.columns=0,this.wallpaperWidth=0,this.calculateColumnWidth(),this.columnHeights=Array(this.columns).fill(0),window.addEventListener("resize",()=>this.onResize())}calculateColumnWidth(){let e=Math.ceil(this.container.clientWidth/option.maxWidth),t=Math.floor((this.container.clientWidth-option.gap*(1==e?0:e-1))/e);this.columns=e,this.wallpaperWidth=t}setWallpapers(e=0){let t=$all(`#${option.container} > div`);for(let a=e;a<t.length;a++){let i=t[a],s=Math.min(...this.columnHeights),n=this.columnHeights.indexOf(s),l=n*(this.wallpaperWidth+this.gap),o=s;i.setAttribute("style",`width: ${this.wallpaperWidth}px;
    position: absolute;
    left: 0;
    top: 0;
    transform: translateX(${l}px) translateY(${o}px);
    `);let r=i.offsetHeight;this.columnHeights[n]+=r+this.gap}this.updateContainerHeight()}updateContainerHeight(){let e=Math.max(...this.columnHeights);this.container.style.height=`${e}px`}onResize(){this.calculateColumnWidth(),this.columnHeights=Array(this.columns).fill(0),this.setWallpapers()}addWallpapers(e){let t=$all(`#${option.container} > div`);t=t.length,this.container.insertAdjacentHTML("beforeend",e),this.setWallpapers(t)}}class checkBottomAndLoadMore{constructor(e="gallery-end-checkers"){this.endChecker=$id(e),this.loader=$(`#${e} > .loader`),this.noWallpaper=$(`#${e} > .no-wallpaper`)}startObserver(e){new IntersectionObserver((t,a)=>{t.forEach(t=>{if(t.isIntersecting){this.loader.classList.remove("invisible");let i=new FormData;i.append("query",option.query),i.append("page",option.nextPage),i.append("range",option.load),fetchDataVersion2(option.api,"POST",i).then(t=>{this.loader.classList.add("invisible"),isValidHTML(t)&&"end"!=t?(e.addWallpapers(t),imgObserver(2),this.startObserver(e),option.nextPage+=1):this.noWallpaper.classList.remove("invisible")}).catch(),a.unobserve(t.target)}})}).observe(this.endChecker)}}const search=()=>{let e=new WallpaperLayout;e.setWallpapers();new checkBottomAndLoadMore().startObserver(e),setTimeout(()=>{imgObserver()},5e3)};"interactive"==document.readyState?search():document.addEventListener("DOMContentLoaded",search());